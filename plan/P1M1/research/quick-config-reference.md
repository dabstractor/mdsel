# Quick Configuration Reference - TypeScript ESM for Node.js 20+

## 1. Minimal tsconfig.json (Copy & Paste Ready)

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "sourceMap": true,
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "isolatedModules": true
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}
```

## 2. Minimal package.json (Copy & Paste Ready)

```json
{
  "name": "your-project",
  "version": "1.0.0",
  "type": "module",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "scripts": {
    "build": "tsc",
    "dev": "tsx src/index.ts",
    "start": "node dist/index.js",
    "type-check": "tsc --noEmit"
  },
  "devDependencies": {
    "typescript": "^5.4",
    "tsx": "^4.7"
  }
}
```

## 3. Correct Import Examples

```typescript
// ✓ CORRECT: Always include .js extension
import { MyClass } from './utils/MyClass.js';
import { config } from './config.js';
import express from 'express';

// ✓ CORRECT: Import JSON with assertion
import pkg from './package.json' assert { type: 'json' };

// ✓ CORRECT: Dynamic imports
const module = await import('./dynamic.js');

// ✓ CORRECT: __dirname replacement
import { fileURLToPath } from 'url';
import { dirname } from 'path';
const __dirname = dirname(fileURLToPath(import.meta.url));
```

## 4. Common Mistakes to Avoid

```typescript
// ✗ WRONG: Missing .js extension
import { helper } from './utils';  // ERROR!

// ✗ WRONG: Using .ts extension
import { helper } from './utils.ts';  // ERROR!

// ✗ WRONG: Using require
const express = require('express');  // ERROR!

// ✗ WRONG: Using __dirname directly
console.log(__dirname);  // ERROR: __dirname is not defined
```

## 5. Development Workflow

```bash
# Install dependencies
npm install

# Development with type checking
npm run type-check
npm run dev

# Build for production
npm run build

# Run production build
npm start
```

## 6. File Structure Reference

```
project/
├── package.json              ← Must include "type": "module"
├── tsconfig.json            ← Use config above
├── src/
│   ├── index.ts            ← Entry point
│   ├── utils/
│   │   └── helpers.ts
│   └── types/
│       └── index.ts
├── dist/                    ← Generated by tsc
│   ├── index.js
│   └── index.d.ts
└── README.md
```

## 7. Essential tsconfig.json Options Explained

| Option | Value | Why |
|--------|-------|-----|
| `target` | `ES2022` | Node.js 20 supports ES2022 |
| `module` | `NodeNext` | Future-proof, stays updated |
| `moduleResolution` | `NodeNext` | Aligns with Node.js resolution |
| `strict` | `true` | Catch errors at compile time |
| `declaration` | `true` | Generate .d.ts for types |
| `sourceMap` | `true` | Debug compiled code |
| `isolatedModules` | `true` | Each file transpiles independently |
| `esModuleInterop` | `true` | Better CommonJS interop |

## 8. tsconfig.json for Library Publishing (Includes Declaration Maps)

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./dist",
    "rootDir": "./src",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "strict": true,
    "verbatimModuleSyntax": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "isolatedModules": true,
    "noUncheckedIndexedAccess": true
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}
```

## 9. Advanced: Dual CJS/ESM Publishing

### Build both formats:
```bash
npm run build:esm    # tsc -p tsconfig.esm.json
npm run build:cjs    # tsc -p tsconfig.cjs.json
```

### In package.json:
```json
{
  "exports": {
    ".": {
      "types": "./dist/esm/index.d.ts",
      "import": "./dist/esm/index.js",
      "require": "./dist/cjs/index.js"
    }
  }
}
```

**Note:** Dual publishing is complex. Prefer ESM-only unless legacy support is essential.

## 10. Troubleshooting Quick Reference

| Error | Cause | Fix |
|-------|-------|-----|
| `ERR_MODULE_NOT_FOUND` | Missing .js extension | Add `.js` to imports |
| `Cannot use import statement` | Missing `"type": "module"` | Add to package.json |
| `__dirname is not defined` | Using it directly in ESM | Use fileURLToPath() helper |
| `Cannot find module .ts` | TypeScript path in import | Use `.js` path instead |
| `ERR_IMPORT_ASSERTION_TYPE_MISSING` | Importing JSON wrong way | Use `assert { type: 'json' }` |

## 11. Environment Variables in Development

```bash
# .env
EXAMPLE_VAR=value

# In package.json scripts
"dev": "NODE_OPTIONS=--enable-source-maps tsx src/index.ts"

# Or in code
import * as dotenv from 'dotenv';
dotenv.config();
```

## 12. One-Minute Setup Checklist

- [ ] Create tsconfig.json (use config from #1)
- [ ] Create package.json with `"type": "module"` (use config from #2)
- [ ] Run `npm install typescript tsx`
- [ ] Create `src/index.ts`
- [ ] Run `npm run build` to compile
- [ ] Run `npm start` to execute
- [ ] Check that imports use `.js` extensions

---

**Sources & Official Documentation:**
- https://www.typescriptlang.org/docs/handbook/esm-node.html
- https://www.typescriptlang.org/tsconfig/
- https://nodejs.org/api/esm.html

**Full Research Document:** See `typescript-esm-setup.md` for comprehensive details
